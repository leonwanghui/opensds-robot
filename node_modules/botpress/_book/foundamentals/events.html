
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Events Â· Botpress Official Documentation</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.2">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-noembed/style.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-hints/plugin-hints.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-anchors/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="events.html" />
    
    
    <link rel="prev" href="structure.html" />
    

    </head>
    <body>
        
    
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">Getting Started</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../starting/setup.html">
            
                <a href="../starting/setup.html">
            
                    
                    Installation and Bootstrap
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Foundamentals</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="structure.html">
            
                <a href="structure.html">
            
                    
                    Project Structure
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="2.2" data-path="events.html">
            
                <a href="events.html">
            
                    
                    Events
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.2.1" data-path="events.html">
            
                <a href="events.html#receive">
            
                    
                    Receiving Messages
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.2" data-path="events.html">
            
                <a href="events.html#send">
            
                    
                    Sending Messages
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="conversations.html">
            
                <a href="conversations.html">
            
                    
                    Conversations
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.3.1" data-path="flow.html">
            
                <a href="flow.html">
            
                    
                    Flow Management (Convo)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.2" data-path="umm.html">
            
                <a href="umm.html">
            
                    
                    Content Management (UMM)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="database.html">
            
                <a href="database.html">
            
                    
                    Data Storage
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.4.1" data-path="database.html">
            
                <a href="database.html#kvs">
            
                    
                    Key-Value-Store
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="botfile.html">
            
                <a href="botfile.html">
            
                    
                    Configuration
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Deploying your bot</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../deploy/heroku.html">
            
                <a href="../deploy/heroku.html">
            
                    
                    Heroku
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="../deploy/aws.html">
            
                <a href="../deploy/aws.html">
            
                    
                    AWS
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Advanced concepts</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../advanced/middleware.html">
            
                <a href="../advanced/middleware.html">
            
                    
                    Middleware Chains
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="../advanced/database_helpers.html">
            
                <a href="../advanced/database_helpers.html">
            
                    
                    Database Helpers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="../advanced/debug.html">
            
                <a href="../advanced/debug.html">
            
                    
                    Debugging your bot
            
                </a>
            

            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    

    
        
        <li class="header">Reference</li>
        
        
    
        <li class="chapter " data-level="6.1" data-path="../reference/cli.html">
            
                <a href="../reference/cli.html">
            
                    
                    Command Line Interface (CLI)
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1.1" data-path="../reference/cli.html">
            
                <a href="../reference/cli.html#init">
            
                    
                    init
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.2" data-path="../reference/cli.html">
            
                <a href="../reference/cli.html#list">
            
                    
                    list
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.3" data-path="../reference/cli.html">
            
                <a href="../reference/cli.html#install">
            
                    
                    install
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.4" data-path="../reference/cli.html">
            
                <a href="../reference/cli.html#uninstall">
            
                    
                    uninstall
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.5" data-path="../reference/cli.html">
            
                <a href="../reference/cli.html#create">
            
                    
                    create
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.6" data-path="../reference/cli.html">
            
                <a href="../reference/cli.html#version">
            
                    
                    version
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    

    
        
        <li class="header">Module Development</li>
        
        
    
        <li class="chapter " data-level="8.1" data-path="../modules/how.html">
            
                <a href="../modules/how.html">
            
                    
                    How to create a module
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="8.1.1" data-path="../modules/events.html">
            
                <a href="../modules/events.html">
            
                    
                    Events
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.1.2" data-path="../modules/api.html">
            
                <a href="../modules/api.html">
            
                    
                    Exposing an API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.1.3" data-path="../modules/config.html">
            
                <a href="../modules/config.html">
            
                    
                    Configuration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.1.4" data-path="../modules/icon.html">
            
                <a href="../modules/icon.html">
            
                    
                    Module Icon
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Events</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="events"><a name="events" class="plugin-anchor" href="#events"><i class="fa fa-link" aria-hidden="true"></i></a>Events</h1>
<p><div class="alert alert-undefined hints-alert"><div class="hints-icon"><i class="undefined"></i></div><div class="hints-container"><p><strong>TLDR:</strong> You can listen for incoming messages using the <a href="#hear"><code>bp.hear</code></a> middleware helper. You can reply to messages using the <code>event.reply</code> <a href="umm.html">UMM</a> feature.</p>
</div></div></p>
<h2 id="receive"><a name="receive" class="plugin-anchor" href="#receive"><i class="fa fa-link" aria-hidden="true"></i></a>Receiving Messages (Incoming) </h2>
<p>Your bot will receive events as soon as it is connected to a chat platform (you need to setup a Connector Module for the platform you want) and a user speaks to it. Incoming messages all go through what we call the <strong>Incoming Middleware Chain</strong>. </p>
<blockquote>
<p><strong>Info</strong>: <a href="../advanced/middleware.html">Middleware Chains</a> are an advanced concept that you likely don&apos;t need to know about right now; all you need to know is that modules execute some kind of processing on the incoming message that they can do all sort of things like translating the messages to different languages, tagging the message with NLP entities or even stop the message from being processed by your bot.</p>
</blockquote>
<p>There exists a special built-in middleware that allows your bot to listen for messages based on certain conditions. It is the <a href="#hear"><code>hear</code></a> middleware.</p>
<h3 id="hear"><a name="hear" class="plugin-anchor" href="#hear"><i class="fa fa-link" aria-hidden="true"></i></a>The Hear Middleware </h3>
<h4 id="bphearcondition-handler---void"><a name="bphearcondition-handler---void" class="plugin-anchor" href="#bphearcondition-handler---void"><i class="fa fa-link" aria-hidden="true"></i></a><code>bp.hear(condition, handler) -&gt; void</code></h4>
<p>Utility function to easily register incoming middlewares. </p>
<p>The condition can be a string, a regex or an object. In case of an object, all conditions must match for the handler to be called.</p>
<p>The handler takes the MiddlewareEvent as the first argument and takes the <code>next</code> middleware caller as the second argument. If the <code>next</code> argument is not specified in your handler, botpress assumes you wanted to call it and calls it at the end of the synchronous execution of the handler.</p>
<blockquote>
<p><strong>Note:</strong> While in theory a bot could be built entirely with the <code>hear</code> middleware alone, <strong>it is not very convenient for handling complex conversations</strong>. <code>hear</code> should in general be used for catching high-level actions like menu button clicks. You should use <a href="flow.html"><code>bp.convo</code></a> for handling complex conversations.</p>
</blockquote>
<h4 id="examples-string"><a name="examples-string" class="plugin-anchor" href="#examples-string"><i class="fa fa-link" aria-hidden="true"></i></a>Examples (string)</h4>
<pre><code class="lang-js">bp.hear(<span class="hljs-string">&apos;hello&apos;</span>, (event, next) =&gt; {
  <span class="hljs-comment">// swallow the event by never calling next()</span>
})
</code></pre>
<h4 id="examples-regex"><a name="examples-regex" class="plugin-anchor" href="#examples-regex"><i class="fa fa-link" aria-hidden="true"></i></a>Examples (regex)</h4>
<pre><code class="lang-js">bp.hear(<span class="hljs-regexp">/^hello$/i</span>, event =&gt; {
  <span class="hljs-comment">// next not specified so will be called automatically</span>
})
</code></pre>
<h4 id="examples-object"><a name="examples-object" class="plugin-anchor" href="#examples-object"><i class="fa fa-link" aria-hidden="true"></i></a>Examples (object)</h4>
<pre><code class="lang-js">bp.hear({
  text: <span class="hljs-string">&apos;hello&apos;</span>, <span class="hljs-comment">// simple condition</span>
  <span class="hljs-string">&apos;user.first_name&apos;</span>: <span class="hljs-regexp">/watson$/i</span>, <span class="hljs-comment">// checking a deep property in object</span>
  <span class="hljs-string">&apos;raw.phone.number&apos;</span>: value =&gt; !<span class="hljs-built_in">Number</span>.isNaN(value), <span class="hljs-comment">// matcher function</span>
  platform: <span class="hljs-string">&apos;sms&apos;</span>
}, event =&gt; {
  <span class="hljs-comment">// all the conditions matched</span>
})
</code></pre>
<hr>
<h2 id="send"><a name="send" class="plugin-anchor" href="#send"><i class="fa fa-link" aria-hidden="true"></i></a>Sending Messages (Outgoing) </h2>
<p>The act of sending a message is called <strong>Outgoing</strong>. There are two ways to send messages: in reaction to an incoming message (<a href="#reactive">Reactive Outgoing</a>) or at any other time (<a href="#proactive">Proactive Outgoing</a>).</p>
<h3 id="reactive"><a name="reactive" class="plugin-anchor" href="#reactive"><i class="fa fa-link" aria-hidden="true"></i></a>Reactive Outgoing </h3>
<p>The easiest way to reply to an incoming message is by calling the <code>reply</code> method on the incoming <code>event</code> itself. The first argument of the <code>reply</code> function is the name of a <a href="../reference/umm.md#bloc">UMM bloc</a>, which we will cover a bit later in this guide.</p>
<h5 id="example"><a name="example" class="plugin-anchor" href="#example"><i class="fa fa-link" aria-hidden="true"></i></a>Example</h5>
<pre><code class="lang-js">bp.hear(<span class="hljs-regexp">/^hello$/i</span>, (event, next) =&gt; {
  event.reply(<span class="hljs-string">&apos;#welcome&apos;</span>)
})
</code></pre>
<pre><code class="lang-js">bp.hear(<span class="hljs-regexp">/^my order$/i</span>, (event, next) =&gt; {
  event.reply(<span class="hljs-string">&apos;#orderSummary&apos;</span>, { <span class="hljs-comment">// You can pass arbitrary data to UMM</span>
    orderId: <span class="hljs-number">12463</span>,
    item: <span class="hljs-string">&apos;Nike Shoes&apos;</span>,
    price: <span class="hljs-string">&apos;$156&apos;</span>
  })
})
</code></pre>
<h3 id="proactive"><a name="proactive" class="plugin-anchor" href="#proactive"><i class="fa fa-link" aria-hidden="true"></i></a>Proactive Outgoing </h3>
<p>If you want to send a message at any time and that you don&apos;t have easy access to a previous <code>event</code> that you can <code>reply()</code> to, you might want to consider using the <strong>Proactive Sending</strong> feature of UMM.</p>
<h4 id="proactive_user"><a name="proactive_user" class="plugin-anchor" href="#proactive_user"><i class="fa fa-link" aria-hidden="true"></i></a>Sending to a user (platform independent) </h4>
<p>Since all users are saved to the database, if you have the <strong>userId</strong> (or the full user object), you can send that user a message and the underlying module will do the job. Usually, a userId looks like so: <code>facebook:7473118532</code>, but may differ from platform to platform.</p>
<h5 id="examples"><a name="examples" class="plugin-anchor" href="#examples"><i class="fa fa-link" aria-hidden="true"></i></a>Examples</h5>
<pre><code class="lang-js"><span class="hljs-comment">// With the full user object</span>
bp.umm.sendToUser(event.user, <span class="hljs-string">&apos;#proactiveBloc&apos;</span>)
</code></pre>
<pre><code class="lang-js"><span class="hljs-comment">// With just the user id</span>
bp.umm.sendToUser(<span class="hljs-string">&apos;facebook:7562284991&apos;</span>, <span class="hljs-string">&apos;#proactiveBloc&apos;</span>, { some: <span class="hljs-string">&apos;data&apos;</span> })
</code></pre>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> <span class="hljs-built_in">Promise</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;bluebird&apos;</span>)

<span class="hljs-comment">// Proactively broadcasts a message to all users</span>
<span class="hljs-comment">// Don&apos;t actually do this. If you need to broadcast a message you should use the broadcast module</span>
<span class="hljs-comment">// The broadcast module handles failures, retries automatically, logs stuff etc.</span>
bp.db.get().then(knex =&gt; knex(<span class="hljs-string">&apos;users&apos;</span>).select(<span class="hljs-string">&apos;id&apos;</span>))
.then(users =&gt; users.map(u =&gt; u.id))
.then(userIds =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.mapSeries(userIds, userId =&gt; {
    bp.umm.sendToUser(userId, <span class="hljs-string">&apos;#proactive&apos;</span>)
  })
})
.then(() =&gt; bp.logger.info(<span class="hljs-string">&apos;Done sending to all users&apos;</span>))
</code></pre>
<h4 id="proactive_location"><a name="proactive_location" class="plugin-anchor" href="#proactive_location"><i class="fa fa-link" aria-hidden="true"></i></a>Other way of sending to a channel, group, user, etc.. (platform-specific) </h4>
<p><strong>TODO:</strong> Currently unsupported.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="structure.html" class="navigation navigation-prev " aria-label="Previous page: Project Structure">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="events.html#receive" class="navigation navigation-next " aria-label="Next page: Receiving Messages">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Events","level":"2.2","depth":1,"next":{"title":"Receiving Messages","level":"2.2.1","depth":2,"anchor":"#receive","path":"foundamentals/events.md","ref":"./foundamentals/events.md#receive","articles":[]},"previous":{"title":"Project Structure","level":"2.1","depth":1,"path":"foundamentals/structure.md","ref":"./foundamentals/structure.md","articles":[]},"dir":"ltr"},"config":{"plugins":["noembed","sitemap","expandable-chapters","hints","anchors","robotstxt"],"root":"./docs","styles":{"website":"./_layouts/website/style.css"},"pluginsConfig":{"robotstxt":{},"search":{},"hints":{"danger":"fa fa-exclamation-circle","info":"fa fa-info-circle","tip":"fa fa-mortar-board","working":"fa fa-wrench"},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"sitemap":{"hostname":"https://docs.botpress.io/"},"noembed":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"anchors":{},"expandable-chapters":{}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{"version":"1.0.5","assets":"https://raw.githubusercontent.com/botpress/botpress/next/assets"},"title":"Botpress Official Documentation","gitbook":">= 3.0.0"},"file":{"path":"foundamentals/events.md","mtime":"2017-06-05T21:41:03.000Z","type":"markdown"},"gitbook":{"version":"3.2.2","time":"2017-06-09T15:03:30.456Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>


    <script>
        window.onload = function() {
          require(['gitbook', 'jQuery'], function(gitbook, $) {
            function removeGitbook() {
              var link = $('.gitbook-link').parent();
              link.prev().remove();
              link.remove();
            }
            removeGitbook();
            gitbook.events.bind('page.change', removeGitbook);

            var link = document.createElement('link')
            link.setAttribute('rel', 'stylesheet')
            link.setAttribute('type', 'text/css')
            link.setAttribute('href', 'https://cdn.rawgit.com/botpress/botpress/next/docs/_layouts/website/style.css')
            document.getElementsByTagName('head')[0].appendChild(link)
          })
        };
    </script>


        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-noembed/scripts.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

