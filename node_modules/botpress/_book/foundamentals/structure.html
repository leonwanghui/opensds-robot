
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Project Structure Â· Botpress Official Documentation</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.2">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-noembed/style.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-hints/plugin-hints.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-anchors/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="events.html" />
    
    
    <link rel="prev" href="../starting/setup.html" />
    

    </head>
    <body>
        
    
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">Getting Started</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../starting/setup.html">
            
                <a href="../starting/setup.html">
            
                    
                    Installation and Bootstrap
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Foundamentals</li>
        
        
    
        <li class="chapter active" data-level="2.1" data-path="structure.html">
            
                <a href="structure.html">
            
                    
                    Project Structure
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="events.html">
            
                <a href="events.html">
            
                    
                    Events
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.2.1" data-path="events.html">
            
                <a href="events.html#receive">
            
                    
                    Receiving Messages
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.2" data-path="events.html">
            
                <a href="events.html#send">
            
                    
                    Sending Messages
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="conversations.html">
            
                <a href="conversations.html">
            
                    
                    Conversations
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.3.1" data-path="flow.html">
            
                <a href="flow.html">
            
                    
                    Flow Management (Convo)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.2" data-path="umm.html">
            
                <a href="umm.html">
            
                    
                    Content Management (UMM)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="database.html">
            
                <a href="database.html">
            
                    
                    Data Storage
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.4.1" data-path="database.html">
            
                <a href="database.html#kvs">
            
                    
                    Key-Value-Store
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="botfile.html">
            
                <a href="botfile.html">
            
                    
                    Configuration
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Deploying your bot</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../deploy/heroku.html">
            
                <a href="../deploy/heroku.html">
            
                    
                    Heroku
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="../deploy/aws.html">
            
                <a href="../deploy/aws.html">
            
                    
                    AWS
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Advanced concepts</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../advanced/middleware.html">
            
                <a href="../advanced/middleware.html">
            
                    
                    Middleware Chains
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="../advanced/database_helpers.html">
            
                <a href="../advanced/database_helpers.html">
            
                    
                    Database Helpers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="../advanced/debug.html">
            
                <a href="../advanced/debug.html">
            
                    
                    Debugging your bot
            
                </a>
            

            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    

    
        
        <li class="header">Reference</li>
        
        
    
        <li class="chapter " data-level="6.1" data-path="../reference/cli.html">
            
                <a href="../reference/cli.html">
            
                    
                    Command Line Interface (CLI)
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1.1" data-path="../reference/cli.html">
            
                <a href="../reference/cli.html#init">
            
                    
                    init
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.2" data-path="../reference/cli.html">
            
                <a href="../reference/cli.html#list">
            
                    
                    list
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.3" data-path="../reference/cli.html">
            
                <a href="../reference/cli.html#install">
            
                    
                    install
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.4" data-path="../reference/cli.html">
            
                <a href="../reference/cli.html#uninstall">
            
                    
                    uninstall
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.5" data-path="../reference/cli.html">
            
                <a href="../reference/cli.html#create">
            
                    
                    create
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.6" data-path="../reference/cli.html">
            
                <a href="../reference/cli.html#version">
            
                    
                    version
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    

    
        
        <li class="header">Module Development</li>
        
        
    
        <li class="chapter " data-level="8.1" data-path="../modules/how.html">
            
                <a href="../modules/how.html">
            
                    
                    How to create a module
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="8.1.1" data-path="../modules/events.html">
            
                <a href="../modules/events.html">
            
                    
                    Events
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.1.2" data-path="../modules/api.html">
            
                <a href="../modules/api.html">
            
                    
                    Exposing an API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.1.3" data-path="../modules/config.html">
            
                <a href="../modules/config.html">
            
                    
                    Configuration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.1.4" data-path="../modules/icon.html">
            
                <a href="../modules/icon.html">
            
                    
                    Module Icon
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Project Structure</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="structure"><a name="structure" class="plugin-anchor" href="#structure"><i class="fa fa-link" aria-hidden="true"></i></a>Structure</h1>
<h2 id="dissecting-your-first-bot"><a name="dissecting-your-first-bot" class="plugin-anchor" href="#dissecting-your-first-bot"><i class="fa fa-link" aria-hidden="true"></i></a>Dissecting your first bot</h2>
<p>An oversimplified view of the architecture of a Botpress bot could look as below.</p>
<p><img alt="Lifecycle of a Message" width="600" src="https://raw.githubusercontent.com/botpress/botpress/next/assets/message-lifecycle.png"></p>
<p>In simple terms, every single incoming messages are received (and processed) by the <strong>Incoming Middleware Chain</strong>, and every single outgoing messages are processed (and sent) by the <strong>Outgoing Middleware Chain</strong>.</p>
<p>A middleware chain, as the name suggests, is simply an ordered list of <strong>middleware functions</strong>. These middleware functions are what your bot is principaly made of, as they dictate how your bot reacts to incoming and outgoing messages.</p>
<p>You can learn more reading the section <em><a href="../creating-your-bot/understanding-the-middlewares.md">Understanding the Middleware</a></em>.</p>
<h3 id="how-botpress-bots-run"><a name="how-botpress-bots-run" class="plugin-anchor" href="#how-botpress-bots-run"><i class="fa fa-link" aria-hidden="true"></i></a>How Botpress bots run</h3>
<p>Bots created on Botpress are very lightweight and contain very few files. The reason for that is because Botpress itself is a dependency of your bot. Have a look inside the <code>package.json</code> file of your bot and you&apos;ll see something like:</p>
<pre><code class="lang-js">  <span class="hljs-comment">// ...</span>
  <span class="hljs-string">&quot;main&quot;</span>: <span class="hljs-string">&quot;index.js&quot;</span>,
  <span class="hljs-string">&quot;dependencies&quot;</span>: {
    <span class="hljs-string">&quot;botpress&quot;</span>: <span class="hljs-string">&quot;0.x&quot;</span>, <span class="hljs-comment">// &lt;-- Botpress is a local dependency of your bot</span>
    <span class="hljs-string">&quot;botpress-web&quot;</span>: <span class="hljs-string">&quot;1.x&quot;</span>
  },
  <span class="hljs-comment">// ...</span>
</code></pre>
<p>So all the core logic of Botpress is inside the botpress package. When you do <code>npm start</code> or <code>botpress start</code> (they are the same thing), what happens is that the <strong>local version of Botpress</strong> loads your bot (in this case <code>index.js</code> since this is what the package.json says is the &quot;main&quot; file).</p>
<blockquote>
<p><strong>HEADS UP:</strong> Do <em>not</em> confuse the global Botpress (the CLI) with the local version of Botpress installed in your bot. They are two different things. You could in theory have 40 bots on your machine, each running their own different version of Botpress.</p>
</blockquote>
<h3 id="project-structure"><a name="project-structure" class="plugin-anchor" href="#project-structure"><i class="fa fa-link" aria-hidden="true"></i></a>Project Structure</h3>
<p><strong>Your bot is a regular NodeJS program.</strong> This is something very important to understand. Excluding the fact that Botpress itself <em>loads</em> your bot, there is no magic or anything special about your bot&apos;s code. If you can write NodeJS, you can easily create a bot!</p>
<p>When you used the CLI to create your first bot, some files were added to your bot&apos;s directory. Let&apos;s go over them quickly so you understand the overall architecture.</p>
<pre><code class="lang-markdown"><span class="hljs-bullet">* </span>index.js
<span class="hljs-bullet">* </span>content.yml
<span class="hljs-bullet">* </span>botfile.js
<span class="hljs-bullet">* </span>package.json
<span class="hljs-bullet">* </span>theme.scss
<span class="hljs-bullet">* </span>LICENSE
<span class="hljs-bullet">* </span>/modules_config
<span class="hljs-bullet">* </span>/data
</code></pre>
<p>The only important files you&apos;ll ever risk to deal with are: <code>index.js</code>, <code>content.yml</code> and <code>botfile.js</code></p>
<h4 id="indexjs"><a name="indexjs" class="plugin-anchor" href="#indexjs"><i class="fa fa-link" aria-hidden="true"></i></a>index.js</h4>
<p><div class="alert alert-undefined hints-alert"><div class="hints-icon"><i class="undefined"></i></div><div class="hints-container"><p><strong>TLDR: This file contains all your bot&apos;s logic</strong>.</p>
</div></div></p>
<h5 id="example"><a name="example" class="plugin-anchor" href="#example"><i class="fa fa-link" aria-hidden="true"></i></a>Example</h5>
<pre><code class="lang-js"><span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">bp</span>) </span>{
  <span class="hljs-comment">// GET_STARTED is the first message you get on Facebook Messenger</span>
  bp.hear(<span class="hljs-regexp">/GET_STARTED|hello|hi|hey/i</span>, (event, next) =&gt; {
    event.reply(<span class="hljs-string">&apos;#welcome&apos;</span>) <span class="hljs-comment">// #welcome is the name of a message bloc defined in `content.yml`</span>
  })
}
</code></pre>
<p>This is your bot&apos;s entry point. This is what Botpress will <strong>load</strong> when doing <code>npm start</code>. This file should always export a function accepting an instance of Botpress (abbreviated <code>bp</code>).</p>
<p>The simplified booting of a botpress bot works like this:</p>
<ol>
<li>Read your bot&apos;s package.json</li>
<li>Check its dependencies and see if any is a valid Botpress module</li>
<li>Load the modules one by one</li>
<li>Start a web server and expose a graphical interface</li>
<li>Load the bot&apos;s entry point and provide a reference to the global Botpress instance (<code>bp</code>)</li>
</ol>
<p>Since this is the entry point, all the logic goes there. Of course, you are 100% free (and encouraged) to write clean code and separate the code into multiple files and arrange it whichever way you want.</p>
<h4 id="contentyaml"><a name="contentyaml" class="plugin-anchor" href="#contentyaml"><i class="fa fa-link" aria-hidden="true"></i></a>content.yaml</h4>
<p>This file contains all the conversational content your bot is going to speak to users. It&apos;s a Botpress-specific language called UMM (<a href="umm.html">Universal Message Markdown</a>). More about this later.</p>
<h5 id="example"><a name="example" class="plugin-anchor" href="#example"><i class="fa fa-link" aria-hidden="true"></i></a>Example</h5>
<pre><code class="lang-yaml"><span class="hljs-attr">welcome:</span>
<span class="hljs-bullet">  -</span> Hello, world!

<span class="hljs-attr">bye:</span>
<span class="hljs-bullet">  -</span> Good bye!
</code></pre>
<h4 id="botfilejs"><a name="botfilejs" class="plugin-anchor" href="#botfilejs"><i class="fa fa-link" aria-hidden="true"></i></a>botfile.js</h4>
<p>This is your bot configuration file. It&apos;s pretty self-explanatory, so you can open it and see by yourself what you can configure.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../starting/setup.html" class="navigation navigation-prev " aria-label="Previous page: Installation and Bootstrap">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="events.html" class="navigation navigation-next " aria-label="Next page: Events">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Project Structure","level":"2.1","depth":1,"next":{"title":"Events","level":"2.2","depth":1,"path":"foundamentals/events.md","ref":"./foundamentals/events.md","articles":[{"title":"Receiving Messages","level":"2.2.1","depth":2,"anchor":"#receive","path":"foundamentals/events.md","ref":"./foundamentals/events.md#receive","articles":[]},{"title":"Sending Messages","level":"2.2.2","depth":2,"anchor":"#send","path":"foundamentals/events.md","ref":"./foundamentals/events.md#send","articles":[]}]},"previous":{"title":"Installation and Bootstrap","level":"1.2","depth":1,"path":"starting/setup.md","ref":"starting/setup.md","articles":[]},"dir":"ltr"},"config":{"plugins":["noembed","sitemap","expandable-chapters","hints","anchors","robotstxt"],"root":"./docs","styles":{"website":"./_layouts/website/style.css"},"pluginsConfig":{"robotstxt":{},"search":{},"hints":{"danger":"fa fa-exclamation-circle","info":"fa fa-info-circle","tip":"fa fa-mortar-board","working":"fa fa-wrench"},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"sitemap":{"hostname":"https://docs.botpress.io/"},"noembed":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"anchors":{},"expandable-chapters":{}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{"version":"1.0.5","assets":"https://raw.githubusercontent.com/botpress/botpress/next/assets"},"title":"Botpress Official Documentation","gitbook":">= 3.0.0"},"file":{"path":"foundamentals/structure.md","mtime":"2017-06-02T21:33:47.000Z","type":"markdown"},"gitbook":{"version":"3.2.2","time":"2017-06-09T15:03:30.456Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>


    <script>
        window.onload = function() {
          require(['gitbook', 'jQuery'], function(gitbook, $) {
            function removeGitbook() {
              var link = $('.gitbook-link').parent();
              link.prev().remove();
              link.remove();
            }
            removeGitbook();
            gitbook.events.bind('page.change', removeGitbook);

            var link = document.createElement('link')
            link.setAttribute('rel', 'stylesheet')
            link.setAttribute('type', 'text/css')
            link.setAttribute('href', 'https://cdn.rawgit.com/botpress/botpress/next/docs/_layouts/website/style.css')
            document.getElementsByTagName('head')[0].appendChild(link)
          })
        };
    </script>


        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-noembed/scripts.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

